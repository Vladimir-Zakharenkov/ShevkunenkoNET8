@model ArticleViewModel

@{
	int n = 0; // количество миниатюр фотографий
}

<div class="mx-auto fluid-font-size" itemscope itemtype="https://schema.org/Book">

	<meta itemprop="author" content="@Model.BookOrArticle.AuthorOfText" />
	<meta itemprop="headline" content="@Model.BookOrArticle.CaptionOfText" />
	<meta itemprop="url" content="https://@Context.Request.Host@Context.Request.Path@Context.Request.QueryString">
	<meta itemprop="publisher" content="@Model.BookOrArticle.Publisher">
	<meta itemprop="dateModified datePublished dateModified" content="@Model.BookOrArticle.DateOfPublication.ToString("yyyy-MM-ddTHH:mm:ssZ")">
	<meta itemprop="description" content="@Model.BookOrArticle.BookDescription">

	@* выбор картинки для книги *@
	<span itemprop="image" itemscope itemtype="http://schema.org/ImageObject">

		@if (Model.BookOrArticle.ScanOfArticle != null)
		{
			<meta itemprop="caption" content="@Model.BookOrArticle.ScanOfArticle.ImageCaption">
			<link itemprop="contentUrl url" href="https://@Context.Request.Host@Model.BookOrArticle.ScanOfArticle.ImagePath/@Model.BookOrArticle.ScanOfArticle.WebImageFileName">
			<link itemprop="thumbnailUrl" href="https://@Context.Request.Host@Model.BookOrArticle.ScanOfArticle.ImagePath/@Model.BookOrArticle.ScanOfArticle.WebIconFileName">
			<meta itemprop="width" content="@Model.BookOrArticle.ScanOfArticle.WebImageWidth">
			<meta itemprop="height" content="@Model.BookOrArticle.ScanOfArticle.WebImageHeight">
		}
		else if (Model.BookOrArticle.LogoOfArticle != null)
		{
			<meta itemprop="caption" content="@Model.BookOrArticle.LogoOfArticle.ImageCaption">
			<link itemprop="contentUrl url" href="https://@Context.Request.Host@Model.BookOrArticle.LogoOfArticle.ImagePath/@Model.BookOrArticle.LogoOfArticle.WebImageFileName">
			<link itemprop="thumbnailUrl" href="https://@Context.Request.Host@Model.BookOrArticle.LogoOfArticle.ImagePath/@Model.BookOrArticle.LogoOfArticle.WebIconFileName">
			<meta itemprop="width" content="@Model.BookOrArticle.LogoOfArticle.WebImageWidth">
			<meta itemprop="height" content="@Model.BookOrArticle.LogoOfArticle.WebImageHeight">
		}
		else
		{
			<meta itemprop="caption" content="@Model.PageInfo.ImageFileModel!.ImageCaption">
			<link itemprop="contentUrl url" href="https://@Context.Request.Host@Model.PageInfo.ImageFileModel.ImagePath/@Model.PageInfo.ImageFileModel.WebImageFileName">
			<link itemprop="thumbnailUrl" href="https://@Context.Request.Host@Model.PageInfo.ImageFileModel.ImagePath/@Model.PageInfo.ImageFileModel.WebIconFileName">
			<meta itemprop="width" content="@Model.PageInfo.ImageFileModel.WebImageWidth">
			<meta itemprop="height" content="@Model.PageInfo.ImageFileModel.WebImageHeight">
		}

	</span>

	@* заголовок книги *@
	<header itemprop="headline" class="d-block col col-md-8 my-3 mx-auto maxwidth700px">

		@if (Context.Request.QueryString.ToString().Contains("pagenumber=0"))
		{
			<h1 class="lay1 p-2 lh-1 times-new-roman">
				<span class="fs-2 fw-bold d-inline-block mb-1 h1_print" itemprop="name">
					@Model.BookOrArticle.AuthorOfText
				</span>
				<span itemprop="url" class="d-none">
					https://@Context.Request.Host@Context.Request.Path@Context.Request.QueryString
				</span>
				<br />
				<span class="fs-2 fw-bold">
					«@Model.BookOrArticle.CaptionOfText»
				</span>
				@if (!string.IsNullOrEmpty(Model.BookOrArticle.TheSubtitle))
				{
					<br />
					<span class="fs-5 text_shadow">
						@Model.BookOrArticle.TheSubtitle
					</span>
				}
			</h1>
		}
		else
		{
			<h1 class="fs-4 fw-bold px-0 pb-2 pt-1 lh-1 lay1 times-new-roman text_shadow">
				<span class="d-inline-block h1_print" itemprop="name">
					@Model.BookOrArticle.AuthorOfText
				</span>
				<span itemprop="url" class="d-none">
					https://@Context.Request.Host@Context.Request.Path@Context.Request.QueryString
				</span>
				<br class="d-lg-none" />
				<span>
					«@Model.BookOrArticle.CaptionOfText»
				@* </span>
				@if (Model.Audio == true)
				{
					<br />
					<br />
					<span class="fs-3 fw-normal">
						Аудиокнига
					</span> *@
				}
			</h1>
		}

	</header>

	@* статья и кадры *@
	<div class="row">

		@* кадры слева *@
		@if (Model.FramesAroundMainContent.FramesOnTheLeft.Length > 0)
		{
			<div class="col-2 mx-auto d-none d-md-block overflow-y-auto overflow-x-hidden height1000">

				@foreach (var item in Model.FramesAroundMainContent.FramesOnTheLeft)
				{
					@* Вывод фотографии в отдельное окно *@
					@* <a href="@item.ImagePath/@(string.IsNullOrEmpty(item.WebImageHDFileName) == false ? item.WebImageHDFileName : item.WebImageFileName)"
                       class=""
                       title="@item.ImageAltTitle"
                       onclick="this.target='_blank'"> *@

					<a asp-area=""
					   asp-controller="Books"
					   asp-action="PhotoAlbum"
					   asp-route-albumCaption="@Model.BookOrArticle.CaptionOfText.Replace(' ', '-')"
					   asp-route-imageId="@item.ImageFileModelId"
					   class="">

						<vc:view-image image-id="@item.ImageFileModelId"
									   css-class="my-2 w-100 shadw imageref"
									   icon-type="webicon200" />

					</a>
				}

			</div>
		}
		else
		{
			<div class="col-2 d-none d-md-block"></div>
		}


		@* текст *@
		<div class="col col-md-8 article_page mx-auto paragraph shadw
						@(Context.Request.QueryString.ToString().Contains("pagenumber=0") ? "px-0 px-sm-2 px-md-3" : "")
						@(Model.Scan == true ? "mt-4 overflow-y-auto overflow-x-hidden height1000" : "")"
			 itemprop="articleBody text">

			@* инфо вверху страницы *@
			<@* div class="@((Model.PageNumber != 0 && Model.Audio != true && Model.Scan != true) ? "" : "d-none")"> *@

				<div class="mb-4 top_page d-print-none">

					@* иконка аудио *@
					<a class="@(Model.TextForBookOrArticle!.AudioInfoModel != null ? "" : "d-none")"
					   asp-area=""
					   asp-controller="Books"
					   asp-action="Book"
					   asp-route-bookCaption="@Model.BookOrArticle.CaptionOfText"
					   asp-route-pageNumber="@Model.TextForBookOrArticle.AudioInfoModel?.SequenceNumber"
					   asp-route-audio="true"
					   title="аудиокнига">

						<vc:view-image image-id="2b306319-5e41-424c-f80c-08ddf7c913e1"
									   css-class="float-start me-2 maxwidth40px shadw imageref d-print-none"
									   icon-type="webicon100" />

					</a>


					@* иконка видео *@
					<a class="@(Model.BookOrArticle.VideoForBookOrArticle != null ? "" : "d-none")"
					   asp-area=""
					   asp-controller="AllVideo"
					   asp-action="Movie"
					   asp-route-movieId="@Model.BookOrArticle.VideoForBookOrArticleId"
					   asp-route-pageOfSeries="true"
					   asp-route-videohosting="@Model.BookOrArticle.VideoForBookOrArticle?.MovieVkVideo"
					   title="видео к тексту">

						<vc:view-image image-id="b386f45b-fc84-4748-bc75-08dd67cfc8ed"
									   css-class="float-start me-2 maxwidth40px shadw imageref"
									   icon-type="webicon100" />

					</a>

					@* иконка принтера *@
					<a class=""
					   href="javascript:window.print(); void 0;"
					   title="распечатать страницу">

						<vc:view-image image-id="f271cf6f-a66e-4c55-9d5e-08dc1058c236"
									   css-class="float-start maxwidth40px shadw imageref  d-print-none"
									   icon-type="webicon100" />

					</a>

					@* номер страницы *@
					<p class="float-end text-primary mt-2 mt-lg-1 nomstr fluid-font-size">
						@Model.PageNumber
					</p>

				</div>

			</div>

			@* текст статьи *@
			@* <div class="@(Model.Audio == false ? "minheight900 times-new-roman" : "d-none") "> *@

				@Html.Raw(Model.HtmlText)

			</div>

			@* аудиокнига *@
			@* <div class="@(Model.Audio == true ? "minheight900 times-new-roman" : "d-none") "> *@

				@* <p class="@(string.IsNullOrEmpty(Model.TextForBookOrArticle.AudioInfoModel?.CaptionOfTextInAudioFile) ? "d-none" : "text-center fs-3 fw-bold")">
					@Model.TextForBookOrArticle.AudioInfoModel?.CaptionOfTextInAudioFile
				</p>

				<p class="@(Model.TextForBookOrArticle.AudioInfoModel.AudioBookModel != null ? "d-none" : "text-center fs-3 fw-bold")">
					читает @Model.TextForBookOrArticle.AudioInfoModel.AudioBookModel.ActorOfAudioBook
				</p> *@




			</div>

			@* инфо внизу страницы *@
			<footer class="@((Model.Scan == true || Model.PageNumber == 0) ? "d-none" : "mt-3 footer_page")">

				@* иконка аудио *@
				<a class="@(Model.TextForBookOrArticle!.AudioInfoModel != null ? "d-print-none" : "d-none")"
				   asp-area=""
				   asp-controller="Books"
				   asp-action="Book"
				   asp-route-bookCaption="@Model.BookOrArticle.CaptionOfText"
				   asp-route-pageNumber="@Model.TextForBookOrArticle.AudioInfoModel?.SequenceNumber"
				   asp-route-audio="true"
				   title="аудиокнига">

					<vc:view-image image-id="2b306319-5e41-424c-f80c-08ddf7c913e1"
								   css-class="float-start me-2 maxwidth40px shadw imageref d-print-none"
								   icon-type="webicon100" />

				</a>

				@* иконка видео *@
				<a class="@(Model.BookOrArticle.VideoForBookOrArticle != null ? "d-print-none" : "d-none")"
				   asp-area=""
				   asp-controller="AllVideo"
				   asp-action="Movie"
				   asp-route-movieId="@Model.BookOrArticle.VideoForBookOrArticleId"
				   asp-route-pageOfSeries="true"
				   asp-route-videohosting="@Model.BookOrArticle.VideoForBookOrArticle?.MovieVkVideo"
				   title="видео к тексту">

					<vc:view-image image-id="b386f45b-fc84-4748-bc75-08dd67cfc8ed"
								   css-class="float-start me-2 maxwidth40px shadw imageref"
								   icon-type="webicon100" />

				</a>

				@* иконка принтера *@
				<a class="d-print-none"
				   href="javascript:window.print(); void 0;"
				   title="распечатать страницу">

					<vc:view-image image-id="f271cf6f-a66e-4c55-9d5e-08dc1058c236"
								   css-class="float-start maxwidth40px shadw imageref  d-print-none"
								   icon-type="webicon100" />

				</a>

				@* номер страницы *@
				<p class="float-end text-primary mt-2 mt-lg-1 nomstr fluid-font-size">
					@Model.PageNumber
				</p>

			</footer>

		</div>

		@* кадры справа *@
		@if (Model.FramesAroundMainContent.FramesOnTheRight.Length > 0)
		{
			<div class="col-2 mx-auto d-none d-md-block overflow-y-auto overflow-x-hidden height1000">

				@foreach (var item in Model.FramesAroundMainContent.FramesOnTheRight)
				{
					@* Вывод фотографии в отдельное окно *@
					@* <a href="@item.ImagePath/@(string.IsNullOrEmpty(item.WebImageHDFileName) == false ? item.WebImageHDFileName : item.WebImageFileName)"
                       class=""
                       title="@item.ImageAltTitle"
                       onclick="this.target='_blank'"> *@

					<a asp-area=""
					   asp-controller="Books"
					   asp-action="PhotoAlbum"
					   asp-route-albumCaption="@Model.BookOrArticle.CaptionOfText.Replace(' ', '-')"
					   asp-route-imageId="@item.ImageFileModelId"
					   class="">

						<vc:view-image image-id="@item.ImageFileModelId"
									   css-class="my-2 w-100 shadw imageref"
									   icon-type="webicon200" />

					</a>
				}

			</div>
		}
		else
		{
			<div class="col-2 d-none d-md-block"></div>
		}


	</div>

	@* навигация по статье *@
	<div class="@(Model.PageNumber == 0 ? "d-none" : "col col-md-8 maxwidth700px mt-4 mb-0 mx-auto clearfix d-print-none")">

		@* переход к предыдущей странице*@
		<a class="@((Model.PageNumber > 1 && Model.Scan != true) ? " btn btn-outline-primary py-1 float-start shadw" : "d-none")"
		   asp-area=""
		   asp-controller="Books"
		   asp-action="Book"
		   asp-route-bookCaption="@Model.BookOrArticle.CaptionOfText.Replace(' ', '-')"
		   asp-route-pageNumber="@(Model.PageNumber - 1)"
		   title="предыдущая странице"
		   itemprop="url">

			<span class="nomstr fluid-font-size">
				@(Model.PageNumber - 1)
			</span>

		</a>

		@* переход к следующей странице*@
		<a class="@((Model.PageNumber < Model.BookOrArticle.NumberOfPages && Model.Scan != true) ? "btn btn-outline-primary py-1 float-end shadw" : "d-none")"
		   asp-area=""
		   asp-controller="Books"
		   asp-action="Book"
		   asp-route-bookCaption="@Model.BookOrArticle.CaptionOfText.Replace(' ', '-')"
		   asp-route-pageNumber="@(Model.PageNumber + 1)"
		   title="следующая странице"
		   itemprop="url">

			<span class="nomstr fluid-font-size">
				@(Model.PageNumber + 1)
			</span>

		</a>

	</div>

	@* раскрывающиеся поля *@
	<div id="accordionForBook"
		 class="@* @(Model.PageNumber == 0 || Model.Audio == true ? "d-none" : "accordion maxwidth700px mx-auto mt-4 d-print-none") *@">

		@* страницы книги *@
		<div class="accordion-item my-3 shadw">

			@* заголовок группы «страницы книги» *@
			<h2 class="accordion-header" id="headingPagesOfBook">

				<button class="accordion-button collapsed py-1 stranicy" type="button" data-bs-toggle="collapse" data-bs-target="#PagesOfBook" aria-expanded="true" aria-controls="PagesOfBook">

					<span class="d-inline-block w-100 fs-5">Страницы книги :</span>

				</button>

			</h2>

			<div id="PagesOfBook" class="accordion-collapse collapse p-2 py-3" aria-labelledby="headingPagesOfBook" data-bs-parent="#accordionForBook">

				@for (int i = 0; i < Model.BookOrArticle.NumberOfPages; i++)
				{
					<a asp-area=""
					   asp-controller="Books"
					   asp-action="Book"
					   asp-route-bookCaption="@Model.BookOrArticle.CaptionOfText.Replace(' ', '-')"
					   asp-route-pagenumber="@(i+1)"
					   class="ref-to-page shadw @(Model.PageNumber == (i+1) ? "text-primary border border-danger" : "")"
					   title="страница @(i + 1)"
					   itemprop="url">

						@(i + 1)

					</a>
				}

			</div>

		</div>

		@* скачать книгу *@
		<div class="accordion-item my-3 shadw">

			@* заголовок группы «скачать книгу» *@
			<h2 class="accordion-header" id="headingLoadBook">

				<button class="accordion-button collapsed py-1 stranicy" type="button" data-bs-toggle="collapse" data-bs-target="#LoadBook" aria-expanded="true" aria-controls="LoadBook">

					<span class="d-none d-sm-block me-2">Скачать книгу :</span>

					@* иконка word *@
					<vc:view-image image-id="562a0cbc-54fb-4059-1187-08dd8ec59a70"
								   css-class="maxwidth40px p-0 me-2"
								   icon-type="webicon100" />

					@* иконка pdf *@
					<vc:view-image image-id="63b93d4a-6f6f-43f9-1188-08dd8ec59a70"
								   css-class="maxwidth40px p-0 me-2"
								   icon-type="webicon100" />

					@* иконка аудиокниги *@
					<vc:view-image image-id="84c9851e-7b45-4bd1-1189-08dd8ec59a70"
								   css-class="maxwidth40px p-0"
								   icon-type="webicon100" />

				</button>

			</h2>

			<div id="LoadBook" class="accordion-collapse collapse p-2" aria-labelledby="headingLoadBook" data-bs-parent="#accordionForBook">

				<div class="accordion-body accordion-body-nointend">

					<div class="row row-cols-3 g-1 g-sm-2 justify-content-center">

						@* текст в формате word *@
						@if (Model.BookOrArticle.RefToWordDoc != null)
						{
							<a href="@Model.BookOrArticle.RefToWordDoc"
							   title="скачать в формате word"
							   onClick="this.target='_blank'">

								<vc:view-image image-id="562a0cbc-54fb-4059-1187-08dd8ec59a70"
											   css-class="col shadw imageref"
											   icon-type="webicon300" />

							</a>
						}
						else
						{
						}


						@* текст в формате pdf *@
						@if (Model.BookOrArticle.RefToPdf != null)
						{
							<a href="@Model.BookOrArticle.RefToPdf"
							   title="скачать в формате pdf"
							   onClick="this.target='_blank'">

								<vc:view-image image-id="63b93d4a-6f6f-43f9-1188-08dd8ec59a70"
											   css-class="col shadw imageref"
											   icon-type="webicon300" />

							</a>
						}
						else
						{
						}


						@* аудиокнига *@
						@if (Model.BookOrArticle.RefToAudio != null)
						{
							<a href="@Model.BookOrArticle.RefToAudio"
							   title="скачать аудиокнигу"
							   onClick="this.target='_blank'">

								<vc:view-image image-id="84c9851e-7b45-4bd1-1189-08dd8ec59a70"
											   css-class="col shadw imageref"
											   icon-type="webicon300" />

							</a>
						}
						else
						{
						}


					</div>

				</div>

			</div>

		</div>

		@* фото из книги *@
		<div class="@((Model.ListOfPictures != null && Model.ListOfPictures.Count > 0) ? "accordion-item my-3 shadw" : "d-none")">

			@* заголовок группы «фото из книги» *@
			<h2 class="accordion-header" id="headingPhoto">

				<button class="accordion-button collapsed py-1 stranicy" type="button" data-bs-toggle="collapse" data-bs-target="#Photo" aria-expanded="true" aria-controls="Photo">

					<span class="d-none d-sm-block me-2">Фото из книги :</span>

					@do
					{
						Random rnd = new();
						int rndIndex = rnd.Next(Model.ListOfPictures.Count);

						<vc:view-image image-id="@Model.ListOfPictures[rndIndex].ImageFileModelId"
									   css-class="maxwidth40px p-0 me-2"
									   icon-type="webicon100" />
						n++;
					}
					while (n < Model.ListOfPictures.Count && n < 5);

				</button>

			</h2>

			<div id="Photo" class="accordion-collapse collapse" aria-labelledby="headingPhoto" data-bs-parent="#accordionForBook">

				<div class="accordion-body accordion-body-nointend p-0 pt-2">

					@* <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-2 pb-2 justify-content-center"> - для «webicon200» *@
					<div class="row row-cols-2 row-cols-sm-4 row-cols-md-5 row-cols-lg-6 g-4 pb-2 justify-content-center">

						@foreach (var item in Model.ListOfPictures)
						{
							<a asp-area=""
							   asp-controller="Books"
							   asp-action="PhotoAlbum"
							   asp-route-albumCaption="@Model.BookOrArticle.CaptionOfText.Replace(' ', '-')"
							   asp-route-imageId="@item.ImageFileModelId"
							   class="col w-auto rounded-3 text-center">

								<vc:view-image image-id="@item.ImageFileModelId.ToString()"
											   css-class="rounded-3 shadw imageref"
											   icon-type="webicon100" />
							</a>
						}

					</div>

				</div>

			</div>

		</div>

		@* аудио *@
		<div class="@(Model.TextForBookOrArticle?.AudioInfoModel == null ? "d-none" : "accordion-item my-3 shadw")">

			@* заголовок группы «Аудио» *@
			<h2 class="accordion-header" id="headingAudioForPage">

				<button class="accordion-button collapsed py-1 stranicy"
						type="button"
						data-bs-toggle="collapse"
						data-bs-target="#AudioForPage"
						aria-expanded="true"
						aria-controls="AudioForPage">

					<span class="d-inline-block w-100 fs-5">Аудиокнига :</span>

				</button>

			</h2>

			<div id="AudioForPage"
				 class="accordion-collapse collapse p-2 py-3"
				 aria-labelledby="headingAudioForPage"
				 data-bs-parent="#accordionForBook">

				<div class="accordion-body accordion-body-nointend">

					<p class="d-sm-none my-2 text_shadow ">
						плейер отображается при разрешении от 576px
					</p>

					<div class="d-none d-sm-flex my-2">

						@Html.Raw(Model.TextForBookOrArticle?.AudioInfoModel?.PlayerPodsterFm)

					</div>

				</div>

			</div>

		</div>

	</div>

</div>